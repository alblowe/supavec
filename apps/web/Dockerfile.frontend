FROM node:20

# 1. Set working directory
WORKDIR /app

# 2. Copy everything (monorepo)
COPY . .

# 3. Enable corepack and install pnpm
RUN corepack enable && corepack prepare pnpm@8.10.5 --activate

# 4. Install all monorepo dependencies (including workspaces)
RUN pnpm install

# 5. Build the web app
WORKDIR /app/apps/web
RUN pnpm build

# 6. Expose port & start the app
EXPOSE 3000
CMD ["pnpm", "start"]
